<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Reports</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <script src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>
  <div class="sidebar">
    <h2>ðŸ’³ TRANSACTION CLASSIFIER</h2>
    <ul>
      <li><a href="{{ url_for('index') }}">Dashboard</a></li>
      <li><a href="{{ url_for('history') }}">History</a></li>
      <li><a href="{{ url_for('reports') }}" class="active">Reports</a></li>
      <li><a href="{{ url_for('logout') }}">Logout</a></li>
    </ul>
  </div>

  <div class="main">
    <h1>Reports Summary</h1>
    <div class="chart-card">
      <div id="piechart" class="piechart"></div>
    </div>

    <script>
      google.charts.load("current", { packages: ["corechart"] });

      function drawChart(data) {
        const rows = [
          ["Legal", Number(data.legal || 0)],
          ["Illegal", Number(data.illegal || 0)],
          ["Suspicious", Number(data.suspicious || 0)]
        ];

        const chartData = google.visualization.arrayToDataTable([
          ["Type", "Count"],
          ...rows
        ]);

        const options = {
          is3D: true,
          legend: { position: "right", textStyle: { fontSize: 12 } },
          chartArea: { left: 20, top: 20, width: "85%", height: "85%" },
          slices: {
            0: { color: "#4CAF50" },
            1: { color: "#F44336" },
            2: { color: "#FF9800" }
          },
          backgroundColor: "transparent"
        };

        const chart = new google.visualization.PieChart(
          document.getElementById("piechart")
        );
        chart.draw(chartData, options);
      }

      fetch("/api/reports/data")
        .then(r => r.json())
        .then(data => {
          google.charts.setOnLoadCallback(() => drawChart(data));
          window.addEventListener("resize", () => drawChart(data));
        });
    </script>
  </div>
</body>
</html>
